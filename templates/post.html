<!DOCTYPE html>
<html 
  xmlns:th="https://www.thymeleaf.org"
  th:replace="~{modules/layout :: html(title = ${post.spec.title} + ' - ' + ${site.title}, content = ~{::content})}"
>
  <th:block th:fragment="content">
    <div class="post-container">
      <article class="post-detail">
        <!-- 文章头部 -->
        <header class="post-header">
        <div class="post-title-wrapper">
          <h1 class="post-title" th:text="${post.spec.title}"></h1>
          <!-- 点赞按钮 - 在标题右边 -->
          <button class="post-upvote-btn" th:attr="data-name=${post.metadata.name}" title="点赞">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            <span class="upvote-count" th:text="${post.stats?.upvote ?: 0}">0</span>
          </button>
        </div>
        <div class="post-meta">
          <time th:text="${#dates.format(post.spec.publishTime, 'yyyy-MM-dd HH:mm')}"></time>
          <span class="separator">·</span>
          <!-- 访问量 -->
          <span class="visit-count">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <span th:text="${post.stats?.visit ?: 0}">0</span>
          </span>
          <span class="separator" th:if="${post.categories != null && !#lists.isEmpty(post.categories)}">·</span>
          <span th:if="${post.categories != null && !#lists.isEmpty(post.categories)}">
            <th:block th:each="category, iterStat : ${post.categories}">
              <a
                th:href="@{${category.status.permalink}}"
                th:text="${category.spec.displayName}"
                class="category"
              ></a>
              <span th:if="${!iterStat.last}"> / </span>
            </th:block>
          </span>
        </div>
        <div class="post-tags" th:if="${post.tags != null && !#lists.isEmpty(post.tags)}">
          <a
            th:each="tag : ${post.tags}"
            th:href="@{${tag.status.permalink}}"
            th:text="|#${tag.spec.displayName}|"
            class="tag"
          ></a>
        </div>
      </header>
      
      <!-- 文章内容 -->
      <div class="post-content-wrapper">
        <div class="post-content" th:utext="${post.content.content}"></div>
      </div>
      
      <!-- 文章底部 -->
      <footer class="post-footer">
        <!-- 上一篇/下一篇 -->
        <div class="post-nav" th:with="postCursor = ${postFinder.cursor(post.metadata.name)}">
          <div class="post-nav-item">
            <a 
              th:if="${postCursor.hasPrevious()}"
              th:href="@{${postCursor.previous.status.permalink}}"
              th:title="${postCursor.previous.spec.title}"
            >
              <span class="nav-label" th:text="#{post.prevPost}">← 上一篇</span>
              <span class="nav-title" th:text="${postCursor.previous.spec.title}"></span>
            </a>
          </div>
          <div class="post-nav-item">
            <a 
              th:if="${postCursor.hasNext()}"
              th:href="@{${postCursor.next.status.permalink}}"
              th:title="${postCursor.next.spec.title}"
            >
              <span class="nav-label" th:text="#{post.nextPost}">下一篇 →</span>
              <span class="nav-title" th:text="${postCursor.next.spec.title}"></span>
            </a>
          </div>
        </div>
        
        <!-- 评论 -->
        <div class="post-comments" th:if="${haloCommentEnabled}">
          <h3 th:text="#{common.comment}">评论</h3>
          <halo:comment 
            group="content.halo.run" 
            kind="Post" 
            th:attr="name=${post.metadata.name}"
          />
        </div>
        </footer>
      </article>

      <!-- 文章目录 -->
      <aside th:if="${theme.config.homepage.show_post_toc}" class="post-toc">
        <div class="post-toc-wrapper">
          <div class="post-toc-header">
            <h3>目录</h3>
          </div>
          <nav class="post-toc-content" id="post-toc"></nav>
        </div>
      </aside>
    </div>
  </th:block>
</html>