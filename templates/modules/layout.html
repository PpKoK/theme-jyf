<!DOCTYPE html>
<html th:lang="${#locale.toLanguageTag}" th:fragment="html (title,content)"
      th:attr="data-theme=${theme.config.style.color_scheme ?: 'light'},
               data-color-scheme=${theme.config.style.color_scheme ?: 'light'}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">

  <!-- 主题颜色 - 根据配置的主题设置 -->
  <meta name="theme-color"
        th:content="${(theme.config.style.color_scheme ?: 'light') == 'dark' ? '#292a2d' : (theme.config.style.background_color ?: '#FAFAFA')}"
        media="(prefers-color-scheme: light)">
  <meta name="theme-color"
        content="#292a2d"
        media="(prefers-color-scheme: dark)">

  <title th:text="${title}"></title>
  <meta name="description" th:content="${site.subtitle}">

  <link rel="stylesheet" th:href="@{/assets/style.css?v={version}(version=${theme.spec.version})}">
  
  <!-- 自定义鼠标指针样式 -->
  <link th:if="${theme.config.cursor != null and theme.config.cursor.cursor_enabled != null and theme.config.cursor.cursor_enabled}" rel="stylesheet" th:href="@{/assets/cursors.css?v={version}(version=${theme.spec.version})}">
  
  <!-- 自定义颜色 -->
  <style th:inline="text">
    :root {
      --link-color: [[${theme.config.style.primary_color ?: '#50E3C2'}]] !important;
      --link-hover: [[${theme.config.style.primary_color ?: '#50E3C2'}]] !important;
      --text-color: [[${theme.config.style.text_color ?: '#34495e'}]];
      --bg-color: [[${theme.config.style.background_color ?: '#ffffff'}]];
      --firefly-color-light: [[${theme.config.style.firefly_color_light ?: '#50E3C2'}]];
      --firefly-color-dark: [[${theme.config.style.firefly_color_dark ?: '#50E3C2'}]];
      --inline-code-color: [[${theme.config.style.inline_code_color ?: '#ff6b6b'}]];
    }
    
    /* 暗夜模式优先级更高 */
    [data-theme="dark"] {
      --bg-color: #292a2d !important;
      --text-color: #a9a9b3 !important;
      --text-secondary: #87888f !important;
      --border-color: #3b3d42 !important;
      --code-bg: #2d2d2d !important;
    }
  </style>
  
  <!-- 主题配置 -->
  <script th:inline="javascript">
    window.themeConfig = {
      loadingAnimationType: /*[[${theme.config.basic.loading_animation_type ?: 'progressbar'}]]*/ 'progressbar',
      fireflyCount: /*[[${theme.config.style.firefly_count ?: 10}]]*/ 10,
      fireflyColorLight: /*[[${theme.config.style.firefly_color_light ?: '#50E3C2'}]]*/ '#50E3C2',
      fireflyColorDark: /*[[${theme.config.style.firefly_color_dark ?: '#50E3C2'}]]*/ '#50E3C2',
      colorScheme: /*[[${theme.config.style.color_scheme ?: 'light'}]]*/ 'light'
    };

    // 立即设置主题，防止页面闪烁
    (function() {
      const configTheme = window.themeConfig?.colorScheme || 'light';
      let currentTheme;

      if (configTheme === 'auto') {
        // 跟随系统
        currentTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      } else {
        // 优先使用用户手动设置
        const savedTheme = localStorage.getItem('theme');
        currentTheme = savedTheme || configTheme;
      }

      // 立即设置主题属性
      document.documentElement.setAttribute('data-theme', currentTheme);
      document.documentElement.setAttribute('data-color-scheme', currentTheme);
    })();
  </script>

  <!-- lightGallery 灯箱 -->
  <link rel="stylesheet" th:href="@{/assets/lib/lightgallery/css/lightgallery-bundle.min.css?v={version}(version=${theme.spec.version})}">
</head>
<body data-color-scheme="auto" th:attr="data-cursor-style=${theme.config.cursor != null and theme.config.cursor.cursor_enabled != null and theme.config.cursor.cursor_enabled ? (theme.config.cursor.cursor_style ?: 'default') : 'default'}">
  <div>
    <th:block th:replace="~{modules/header}" />
    <main class="container">
      <th:block th:replace="${content}" />
    </main>
    <th:block th:replace="~{modules/footer}" />
  </div>
  
  <!-- 返回顶部按钮 -->
  <button class="jyf-fhdb" aria-label="返回顶部">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
  </button>
  
  <!-- lightGallery 灯箱 -->
  <script th:src="@{/assets/lib/lightgallery/js/lightgallery.min.js?v={version}(version=${theme.spec.version})}"></script>
  <script th:src="@{/assets/lib/lightgallery/plugins/zoom/lg-zoom.min.js?v={version}(version=${theme.spec.version})}"></script>
  <script th:src="@{/assets/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js?v={version}(version=${theme.spec.version})}"></script>
  
  <script th:src="@{/assets/main.js?v={version}(version=${theme.spec.version})}"></script>
</body>
</html>